<!DOCTYPE html>
<html>	
  <head>		
    <title>Logik</title>
    <script src="js/angular.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/button.css">	
  </head>
  <body style="background-color: gray;">
<script>
    var app = angular.module("app", []);
    
    app.service("EvaluateService", function() {
     this.isFilledLine = function(colors, activeLine) {
          for (i = 0; i < 5; i++) {  
            if(colors[activeLine][i].length == 0) { 
              return true;
            }
          }
          return false;
     };
     
     this.evaluate = function(evaluated, computerCombination, playerCombination) {
     	var evaluatedLine = ['btn-gray','btn-gray','btn-gray','btn-gray','btn-gray'];
     	var comparedValues1 = [];
     	var comparedValues2 = [];
     	
     	var positionOkCheckedCount = 0;
     	var positionNotOkCheckedCount = 0;
     	
     	for (i = 0; i < 5; i++) {
            if (playerCombination[i] == computerCombination[i]) {
                comparedValues1[i] = true;
                comparedValues2[i] = true;
                positionOkCheckedCount++;
            }
        }
        
        for (i = 0; i < 5; i++) {
            for (j = 0; j < 5; j++) {
                if (playerCombination[i] == computerCombination[j] && !comparedValues1[i] && !comparedValues2[j]) {
                    comparedValues1[i] = true;
                    comparedValues2[j] = true;
                    positionNotOkCheckedCount++;
                }
            }
        }
     	
     	for(i = 0; i < positionOkCheckedCount; i++) {
     		evaluatedLine[i] = 'btn-black';	
     	}
     	
     	for(i = positionOkCheckedCount; i < (positionOkCheckedCount + positionNotOkCheckedCount); i++) {
     		evaluatedLine[i] = 'btn-white';	
     	}
     	
     	return evaluatedLine;
     };
     
     this.canShowCode = function(activeLine, evaluated) {
     	if(activeLine > 9) {
     		return true;
     	}
     	for (i = 0; i < 5; i++) {
     		if(evaluated[i] != 'btn-black') {
     			return false;
     		}
     	}
     	return true;     	
     };
        
    });
    
    app.service("InitService", function() {
     this.initColorArray = function() {
     	var colors = [];
     	for (i = 0; i < 10; i++) {
     		colors[i] = [];          
        	for (j = 0; j < 5; j++) {
            	colors[i][j] = '';
          	}  
        }
     	return colors;  	
     };
     
     this.initColors = function() {
     	return ['btn-red', 'btn-green', 'btn-black', 'btn-yellow', 'btn-orange', 'btn-blue', 'btn-purple', 'btn-olive'];	
     };
     
     this.initEvaluated = function() {
        var evaluated = [];
     	for (i = 0; i < 10; i++) {
     		evaluated[i] = [];          
        	for (j = 0; j < 5; j++) {
            	evaluated[i][j] = 'btn-gray';
          	}  
        }
     	return evaluated;  		
     }
     
    });
    
    app.service("GeneratorService", function() {
     this.generateCode = function(colors) {
     	var code = [];
    		for (i = 0; i < 5; i++) {
    			code[i] = colors[Math.floor(Math.random() * 8)];
    		}
    	return code;	
     };
    	
    });
    
    app.controller("MainController", function ($scope, EvaluateService, InitService, GeneratorService) {
    	//Initialization
        $scope.selectedColor;
        $scope.showError = false;
        $scope.activeLine = 0;
        $scope.colors = InitService.initColorArray();
        $scope.possibleColors = InitService.initColors();
        $scope.computerCombination = GeneratorService.generateCode($scope.possibleColors);    
        $scope.hiddenColors = ['btn-gray','btn-gray','btn-gray','btn-gray','btn-gray'];
        $scope.evaluated = InitService.initEvaluated();
        $scope.disableButton = false;
        
        //Functions        
        $scope.selectColor = function (color) {
			     $scope.selectedColor = color;		
        };
        
        $scope.setColor = function (i,j) {
			     $scope.colors[i][j] = $scope.selectedColor; 
        };
        
        $scope.evaluate = function() {
        $scope.showError = EvaluateService.isFilledLine($scope.colors, $scope.activeLine);
        
        if(!$scope.showError) {
        	$scope.evaluated[$scope.activeLine] = EvaluateService.evaluate($scope.evaluated, $scope.computerCombination, $scope.colors[$scope.activeLine])
          	if(EvaluateService.canShowCode($scope.activeLine, $scope.evaluated[$scope.activeLine])) {
          		$scope.hiddenColors = $scope.computerCombination;
          		$scope.activeLine = -1;
          		$scope.disableButton = true; 
          	} else {
          		$scope.activeLine++; 
          	}
          }	
        };     
      
    });
  
</script>
    <div ng-app="app" ng-controller="MainController" class="container-fluid"">	
      <div>
        <button ng-repeat="i in [0,1,2,3,4]" class="btn btn-circle-big btn-not-allowed" ng-class="hiddenColors[i]"></button>        
      </div>
      <div ng-repeat="i in [9,8,7,6,5,4,3,2,1,0]">	
        <button ng-repeat="j in [0,1,2,3,4]" class="btn btn-circle-big" ng-class="colors[i][j]" ng-disabled="i != activeLine" ng-click="setColor(i,j)"></button>        
      	<button ng-repeat="j in [0,1,2,3,4]" class="btn btn-circle-small btn-not-allowed" ng-class="evaluated[i][j]"></button>
      </div>    
      <div>    	
        <button ng-repeat="color in possibleColors" class="btn btn-circle-big" ng-class="color" ng-click="selectColor(color)">
        </button>	 
      </div>
      <button class = "btn" ng-click="evaluate()" ng-disabled = "disableButton">Táhnout</button>
      <div ng-show="showError">Nejsou vyplnìna všechna pole v {{activeLine + 1}}. øadì</div>
    </div>
  </body>
</html>
